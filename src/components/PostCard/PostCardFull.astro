---
import { type CollectionEntry } from "astro:content";
import { Image } from "astro:assets";

// utils
import { getAllAuthorsData, isDevMode } from "@js/blogUtils";
import { slugify, formatDate, humanize } from "@js/textUtils";

const isDraft = Astro.props.post.data.draft === true;
const showDraftBadge = isDraft && isDevMode();

interface Props {
    post: CollectionEntry<"blog">;
    showDescription?: boolean;
    class?: string;
    rest?: any; // catch-all for any additional parameters, such as "aria-label"
}

const {
    post,
    showDescription = false,
    class: className,
    ...rest
} = Astro.props as Props;
const { title, description, categories, authors, pubDate, heroImage } =
    post.data;

const authorsData = await getAllAuthorsData(authors);
---

<article class=`group grid gap-6 md:grid-cols-[400px_1fr] md:gap-10 ${className}` {...rest}>
    <a
        href={`/blog/${post.slug}/`}
        class="overflow-hidden rounded-xl"
    >
        <figure class="h-full overflow-hidden">
            <Image
                src={heroImage}
                alt={`Cover for ${title}`}
                height={700}
                quality="high"
                class="h-full w-full rounded-xl object-cover transition-all duration-500 group-hover:scale-105"
            />
        </figure>
    </a>
    <div class="flex w-full flex-col gap-3 md:gap-4">
        <!-- categories & date -->
        <div class="flex flex-wrap items-center gap-3">
            {
                showDraftBadge && (
                    <span class="rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-800 ring-1 ring-amber-300">
                        DRAFT
                    </span>
                )
            }
            {
                categories.map((category) => (
                    <a
                        href={`/categories/${slugify(category)}/`}
                        class="button button--ghost px-3 py-1 text-xs font-medium md:text-sm"
                    >
                        {humanize(category)}
                    </a>
                ))
            }
            <span class="text-sm opacity-60">&bull;</span>
            <time class="text-sm opacity-70">
                {formatDate(pubDate)}
            </time>
        </div>

        <!-- title -->
        <div>
            <a
                href={`/blog/${post.slug}/`}
                class="group/title"
            >
                <h2 class="text-xl font-semibold leading-tight transition-colors group-hover/title:text-primary-600 md:text-2xl lg:text-3xl">
                    {title}
                </h2>
            </a>
        </div>

        <!-- description -->
        {
            showDescription && (
                <p class="text-base leading-relaxed opacity-80 md:text-lg">
                    {description}
                </p>
            )
        }

        <!-- author -->
        <div class="mt-auto flex items-center gap-2 text-sm opacity-70">
            <span>By</span>
            <span class="font-medium">{authorsData[0].data.name}</span>
        </div>
    </div>
</article>
